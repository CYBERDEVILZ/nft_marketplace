{% extends "base.html" %}
<!-- TITLE OF THE PAGE -->
{% block title %}
NFT Booth
{% endblock %}

<!-- BODY OF THE PAGE -->
{% block body %}
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="{{url_for('static', filename='web3Connect.js')}}"></script>
<div class="nfts" style="margin: 20px;">
	<div id="gallery">
	</div>
</div>
<br>
    <button type="button" class="btn btn-info" onclick="createnftpage()">Create NFT</button>
<script>
    var contractInstance = null;

    // FUNCTIONS
	function createnftpage(){
		window.location.pathname="/createNFT"
	}

    // retrieve nfts
    retrieveNFT = async () => {
		await access();
		contractInstance = await new web3.eth.Contract(abi, addressContract);
		await contractInstance.methods.mynft(walletAddress).call({from: walletAddress})
		.then((s) => {
			s.forEach(element => {
				var gallery = document.getElementById("gallery")
				var entry = document.createElement("img");
				var tokenId = element["tokenId"]
				entry.id = "nft_images"
				entry.src = element["imageuri"]
				entry.addEventListener("click", ()=>{
					window.location.pathname = "/nftbooth/"+tokenId
				})
				gallery.appendChild(entry)
			});		
		});
    }


    // gets called if the account is changed
    try{
        window.ethereum.on('accountsChanged', (accounts) => {
            if(accounts.length == 0){
                window.location.pathname = "/selectbooth"
            }
            else{
                window.location.reload()
            }
        });
    
        access();
        retrieveNFT();
        
        
    }
    catch(e){
        console.log(e.message)
    }
</script>
{% endblock %}