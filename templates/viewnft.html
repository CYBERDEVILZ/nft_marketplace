{%extends "base.html"%}

{%block title%}
NFT# {{id}}
{%endblock%}

{%block body%}
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="{{ url_for('static', filename='web3Connect.js') }}" type="text/javascript"></script>
<script>
        // FUNCTIONS
	function createnftpage(){
		window.location="/createNFT"
	}

    // retrieve nft DATA
    retrieveNFT = async () => {
        id = "{{id}}"
        contractInstance = await new web3.eth.Contract(abi, addressContract);
        await contractInstance.methods.getNFTdata(id).call({from: walletAddress})
		.then((s) => {
            price = s["price"];
            priceInEth = window.web3.utils.fromWei(price, "ether");
            name = s["name"];
            owner = s["owner"];
            imageuri = s["imageuri"]
            var imagediv = document.getElementById("image")
            var imgelement = document.createElement("img")
            imgelement.src = imageuri
            imagediv.appendChild(imgelement)
           var namediv = document.getElementById("name")
		   var namelement = document.createTextNode(name)
		   namediv.appendChild(namelement)
		   var priceButton = document.getElementById("buttonPrice")
		   priceButton.innerHTML = "Buy: "+priceInEth+" MATIC"
		   if (owner == walletAddress){
			priceButton.setAttribute("disabled", "true")
			var ownedDiv = document.getElementById("owned")
		   ownedDiv.innerHTML = "You own this NFT!"
		   }
           else{
            priceButton.addEventListener("click", () => {buyNFT(id)})
           }
        });		
    }

    

    // gets called if the account is changed
    try{
        window.ethereum.on('accountsChanged', (accounts) => {
            if(accounts.length == 0){
                window.location = "/selectbooth"
            }
            else{
                window.location.reload()
            }
        });
    
        access();
        retrieveNFT();
        
    }
    catch(e){
        console.log(e.message)
    }
</script>
<div id="image">
</div>
<div id="name"></div>
<div id="price">
	<button id="buttonPrice"></button>
</div>
<div id="owned"></div>
{%endblock%}